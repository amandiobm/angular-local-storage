/**
 * An Angular module that gives you access to the browsers local storage
 * @version v0.1.5 - 2015-04-21
 * @link https://github.com/grevory/angular-local-storage
 * @author grevory <greg@gregpike.ca>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */!function(a,b,c){"use strict";function d(a){return/^-?\d+\.?\d*$/.test(a.replace(/["']/g,""))}var e=b.isDefined,f=b.isUndefined,g=b.isNumber,h=b.isObject,i=b.isArray,j=b.extend,k=b.toJson,l=b.fromJson,m=b.module("LocalStorageModule",[]);m.provider("localStorageService",function(){this.prefix="ls",this.storageType="localStorage",this.storages={},this.defaultStorage=this.prefix,this.cookie={expiry:30,path:"/"},this.notify={setItem:!0,removeItem:!1},this.setPrefix=function(a){return this.prefix=a,this.defaultStorage=a,this.addStorage(a,this.storageType),this},this.setStorageType=function(a){return this.storageType=a,this.addStorage(this.prefix,a),this},this.addStorage=function(a,b){return this.storages[a]=b,this},this.setDefaultStorage=function(a){return this.defaultStorage=a,this},this.setStorageCookie=function(a,b){return this.cookie.expiry=a,this.cookie.path=b,this},this.setStorageCookieDomain=function(a){return this.cookie.domain=a,this},this.setNotify=function(a,b){return this.notify={setItem:a,removeItem:b},this},this.$get=["$rootScope","$window","$document","$parse",function(a,b,c,m){var n=this,o=n.defaultStorage,p=n.cookie,q=n.notify,r=n.storages[o],s=n.storages,t={};c?c[0]&&(c=c[0]):c=document,"."!==o.substr(-1)&&(o=o?o+".":"");var u=function(a){return a=a||n.defaultStorage,"."!==a.substr(-1)&&(a=a?a+".":""),a},v=function(a,b){return b=b||u(),b+a},w=function(c,d){if(d=u(d),c=c||n.defaultStorage,t.hasOwnProperty(c))return t[c];try{var e=c in b&&null!==b[c],f=v("__"+Math.round(1e7*Math.random()),d);return e?(t[c]=b[c],t[c].setItem(f,""),t[c].removeItem(f)):t[c]=!1,e}catch(g){return r="cookie",a.$broadcast("LocalStorageModule.notification.error",g.message),!1}},x=function(b,c,d){var e=H(d);if(d=u(d),f(c)?c=null:(h(c)||i(c)||g(+c||c))&&(c=k(c)),!w(e,d)||"cookie"===e)return w(e,d)||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),q.setItem&&a.$broadcast("LocalStorageModule.notification.setitem",{key:b,newvalue:c,storageType:"cookie"}),D(b,c);try{t[e]&&t[e].setItem(v(b,d),c),q.setItem&&a.$broadcast("LocalStorageModule.notification.setitem",{key:b,newvalue:c,storageType:e})}catch(j){return a.$broadcast("LocalStorageModule.notification.error",j.message),D(b,c)}return!0},y=function(b,c){var e=H(c);if(c=u(c),!w(e,c)||"cookie"===e)return w(e,c)||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),E(b);var f=t[e]?t[e].getItem(v(b,c)):null;return f&&"null"!==f?"{"===f.charAt(0)||"["===f.charAt(0)||d(f)?l(f):f:null},z=function(b,c){var d=H(c);if(c=u(c),!w(d,c)||"cookie"===d)return w(d,c)||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),q.removeItem&&a.$broadcast("LocalStorageModule.notification.removeitem",{key:b,storageType:"cookie"}),F(b);try{t[d].removeItem(v(b,c)),q.removeItem&&a.$broadcast("LocalStorageModule.notification.removeitem",{key:b,storageType:d})}catch(e){return a.$broadcast("LocalStorageModule.notification.error",e.message),F(b)}return!0},A=function(b){var c=H(b);if(b=u(b),!w(c,b))return a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),!1;var d=b.length,e=[];for(var f in t[c])if(f.substr(0,d)===b)try{e.push(f.substr(d))}catch(g){return a.$broadcast("LocalStorageModule.notification.error",g.Description),[]}return e},B=function(b,c){var d=H(c);c=u(c);var e=c?new RegExp("^"+c):new RegExp,f=b?new RegExp(b):new RegExp;if(!w(d,c)||"cookie"===d)return w(d,c)||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),G();var g=c.length;for(var h in t[d])if(e.test(h)&&f.test(h.substr(g)))try{z(h.substr(g))}catch(i){return a.$broadcast("LocalStorageModule.notification.error",i.message),G()}return!0},C=function(){try{return b.navigator.cookieEnabled||"cookie"in c&&(c.cookie.length>0||(c.cookie="test").indexOf.call(c.cookie,"test")>-1)}catch(d){return a.$broadcast("LocalStorageModule.notification.error",d.message),!1}}(),D=function(b,d,e){if(f(d))return!1;if((i(d)||h(d))&&(d=k(d)),!C)return a.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;try{var j="",l=new Date,m="";if(null===d?(l.setTime(l.getTime()+-864e5),j="; expires="+l.toGMTString(),d=""):g(e)&&0!==e?(l.setTime(l.getTime()+24*e*60*60*1e3),j="; expires="+l.toGMTString()):0!==p.expiry&&(l.setTime(l.getTime()+24*p.expiry*60*60*1e3),j="; expires="+l.toGMTString()),b){var n="; path="+p.path;p.domain&&(m="; domain="+p.domain),c.cookie=v(b)+"="+encodeURIComponent(d)+j+n+m}}catch(o){return a.$broadcast("LocalStorageModule.notification.error",o.message),!1}return!0},E=function(b){if(!C)return a.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(var d=c.cookie&&c.cookie.split(";")||[],e=0;e<d.length;e++){for(var f=d[e];" "===f.charAt(0);)f=f.substring(1,f.length);if(0===f.indexOf(v(b)+"=")){var g=decodeURIComponent(f.substring(o.length+b.length+1,f.length));try{var h=JSON.parse(g);return l(h)}catch(i){return g}}}return null},F=function(a){D(a,null)},G=function(){for(var a=null,b=o.length,d=c.cookie.split(";"),e=0;e<d.length;e++){for(a=d[e];" "===a.charAt(0);)a=a.substring(1,a.length);var f=a.substring(b,a.indexOf("="));F(f)}},H=function(a){return a=a||n.defaultStorage,s[a]},I=function(a,b,c,d){d=d||b;var f=y(d);return null===f&&e(c)?f=c:h(f)&&h(c)&&(f=j(c,f)),m(b).assign(a,f),a.$watch(b,function(a){x(d,a)},h(a[b]))},J=function(){for(var a=0,c=b[r],d=0;d<c.length;d++)0===c.key(d).indexOf(o)&&a++;return a};return{isSupported:w(),isStorageSupported:w,getStorageType:H,set:x,add:x,get:y,keys:A,remove:z,clearAll:B,bind:I,deriveKey:v,length:J,cookie:{isSupported:C,set:D,add:D,get:E,remove:F,clearAll:G}}}]})}(window,window.angular);